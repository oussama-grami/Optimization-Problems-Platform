<div class="container" [class.dark-theme]="isDarkTheme">
  <button
    class="theme-toggle"
    (click)="toggleTheme()"
    [attr.aria-label]="
      isDarkTheme ? 'Passer au thème clair' : 'Passer au thème sombre'
    "
  >
    <i class="tool-icon">{{ isDarkTheme ? "☀️" : "🌙" }}</i>
  </button>

  <h1 class="title">Coloriage de Graphe Interactif</h1>

  <div class="error-container" *ngIf="error" [@shakeAnimation]>
    <div class="error-message">{{ error }}</div>
    <button class="close-btn" (click)="error = null">×</button>
  </div>

  <div class="graph-interface">
    <div class="tools-panel">
      <div class="tools-group">
        <h3>Outils Graphe</h3>
        <button
          [class.active]="mode === 'move'"
          (click)="setMode('move')"
          title="Déplacer les nœuds ou le canevas"
        >
          <i class="tool-icon">↕</i> Déplacer
        </button>
        <button
          [class.active]="mode === 'add'"
          (click)="setMode('add')"
          title="Ajouter un nouveau nœud"
        >
          <i class="tool-icon">+</i> Ajouter Nœud
        </button>
        <button
          [class.active]="mode === 'delete'"
          (click)="setMode('delete')"
          title="Supprimer un nœud"
        >
          <i class="tool-icon">-</i> Supprimer
        </button>
        <button
          [class.active]="mode === 'connect'"
          (click)="setMode('connect')"
          title="Connecter deux nœuds"
        >
          <i class="tool-icon">↔</i> Connecter
        </button>
      </div>

      <div class="tools-group">
        <h3>Contrôles d'Affichage</h3>
        <button
          (click)="resetView()"
          title="Réinitialiser le zoom et le panoramique"
        >
          <i class="tool-icon">⟲</i> Réinitialiser Vue
        </button>
        <button (click)="resetGraph()" title="Effacer le graphe">
          <i class="tool-icon">🗑</i> Effacer Graphe
        </button>
        <button
          (click)="generateRandomGraph()"
          title="Générer un graphe aléatoire"
        >
          <i class="tool-icon">🎲</i> Graphe Aléatoire
        </button>
      </div>

      <div class="tools-group">
        <h3>Exporter/Importer</h3>
        <button
          (click)="exportImage()"
          title="Sauvegarder le graphe comme une image"
        >
          <i class="tool-icon">📷</i> Exporter Image
        </button>
        <button
          (click)="exportMatrix()"
          title="Exporter la matrice d'adjacence en JSON"
        >
          <i class="tool-icon">📤</i> Exporter Matrice
        </button>
        <div class="file-input-container">
          <label for="importMatrix" class="file-input-label">
            <i class="tool-icon">📥</i> Importer Matrice
          </label>
          <input
            type="file"
            id="importMatrix"
            accept=".json"
            (change)="importMatrix($event)"
            class="file-input"
          />
        </div>
      </div>

      <div class="tools-group">
        <h3>Résoudre</h3>
        <button
          class="solve-btn"
          (click)="colorGraph()"
          [disabled]="isLoading || nodes.length === 0"
          title="Résoudre le problème de coloriage de graphe"
        >
          <i class="tool-icon">🎨</i> Colorier Graphe
        </button>

        <div class="result" *ngIf="chromaticNumber !== null" [@bounceAnimation]>
          <span>Nombre Chromatique: {{ chromaticNumber }}</span>
        </div>
      </div>

      <div class="loading-container" *ngIf="isLoading" [@fadeAnimation]>
        <div class="spinner"></div>
        <span>Traitement en cours...</span>
      </div>
    </div>

    <div class="canvas-container">
      <canvas #graphCanvas></canvas>
      <div class="instructions" *ngIf="nodes.length === 0" [@fadeAnimation]>
        <p>
          Cliquez n'importe où pour ajouter des nœuds, puis connectez-les pour
          créer un graphe.
        </p>
        <p>Utilisez les outils à gauche pour construire votre graphe.</p>
        <p>
          Quand vous êtes prêt, cliquez sur "Colorier Graphe" pour trouver le
          nombre chromatique.
        </p>
      </div>
      <div class="mode-indicator" [@slideAnimation]>
        Mode: {{ mode | titlecase }}
        <span *ngIf="connecting" class="connecting-indicator"
          >Connexion depuis Nœud {{ connecting.id }}</span
        >
      </div>
    </div>
  </div>

  <div
    class="matrix-editor"
    *ngIf="adjacencyMatrix.length > 0"
    [@slideAnimation]
  >
    <h3>Matrice d'Adjacence</h3>
    <p class="matrix-help">
      Modifiez les valeurs pour ajouter ou supprimer des connexions entre les
      nœuds.
    </p>

    <div class="matrix-container">
      <table class="adjacency-matrix">
        <tr>
          <th></th>
          <th *ngFor="let node of nodes; let j = index">{{ j }}</th>
        </tr>
        <tr *ngFor="let row of adjacencyMatrix; let i = index">
          <th>{{ i }}</th>
          <td
            *ngFor="let cell of row; let j = index"
            [class.diagonal]="i === j"
            [class.editable]="i !== j"
            [@cellAnimation]="'in'"
          >
            <input
              type="number"
              min="0"
              max="1"
              [disabled]="i === j"
              [(ngModel)]="adjacencyMatrix[i][j]"
              (change)="matrixValueChanged(i, j)"
            />
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="tips-and-tricks" *ngIf="showTips">
    <h3>Astuces & Conseils</h3>
    <ul>
      <li>Utilisez la molette de la souris pour zoomer et dézoomer</li>
      <li>Faites glisser le canevas pour vous déplacer</li>
      <li>Connectez les nœuds en sélectionnant le mode "Connecter"</li>
      <li>
        L'algorithme de coloriage de graphe trouvera le nombre minimum de
        couleurs
      </li>
      <li>Vous pouvez modifier directement la matrice d'adjacence</li>
      <li>
        <strong>Application 1:</strong> Planification des horaires - Le coloriage de graphe est utilisé pour allouer des créneaux horaires sans conflits pour des examens ou des réunions, où chaque nœud représente un événement et les arêtes représentent des conflits.
      </li>
      <li>
        <strong>Application 2:</strong> Attribution de fréquences radio - Pour éviter les interférences, les fréquences radio peuvent être modélisées comme un problème de coloriage où chaque zone géographique est un nœud et les couleurs sont les différentes fréquences.
      </li>
    </ul>
    <button (click)="showTips = false" class="close-tips">Compris !</button>
  </div>
</div>
