<div class="container" [class.dark-theme]="isDarkTheme">
  <button
    class="theme-toggle"
    (click)="toggleTheme()"
    [attr.aria-label]="
      isDarkTheme ? 'Passer au thÃ¨me clair' : 'Passer au thÃ¨me sombre'
    "
  >
    <i class="tool-icon">{{ isDarkTheme ? "â˜€ï¸" : "ğŸŒ™" }}</i>
  </button>

  <h1 class="title">Coloriage de Graphe Interactif</h1>

  <div class="error-container" *ngIf="error" [@shakeAnimation]>
    <div class="error-message">{{ error }}</div>
    <button class="close-btn" (click)="error = null">Ã—</button>
  </div>

  <div class="graph-interface">
    <div class="tools-panel">
      <div class="tools-group">
        <h3>Outils Graphe</h3>
        <button
          [class.active]="mode === 'move'"
          (click)="setMode('move')"
          title="DÃ©placer les nÅ“uds ou le canevas"
        >
          <i class="tool-icon">â†•</i> DÃ©placer
        </button>
        <button
          [class.active]="mode === 'add'"
          (click)="setMode('add')"
          title="Ajouter un nouveau nÅ“ud"
        >
          <i class="tool-icon">+</i> Ajouter NÅ“ud
        </button>
        <button
          [class.active]="mode === 'delete'"
          (click)="setMode('delete')"
          title="Supprimer un nÅ“ud"
        >
          <i class="tool-icon">-</i> Supprimer
        </button>
        <button
          [class.active]="mode === 'connect'"
          (click)="setMode('connect')"
          title="Connecter deux nÅ“uds"
        >
          <i class="tool-icon">â†”</i> Connecter
        </button>
      </div>

      <div class="tools-group">
        <h3>ContrÃ´les d'Affichage</h3>
        <button
          (click)="resetView()"
          title="RÃ©initialiser le zoom et le panoramique"
        >
          <i class="tool-icon">âŸ²</i> RÃ©initialiser Vue
        </button>
        <button (click)="resetGraph()" title="Effacer le graphe">
          <i class="tool-icon">ğŸ—‘</i> Effacer Graphe
        </button>
        <button
          (click)="generateRandomGraph()"
          title="GÃ©nÃ©rer un graphe alÃ©atoire"
        >
          <i class="tool-icon">ğŸ²</i> Graphe AlÃ©atoire
        </button>
      </div>

      <div class="tools-group">
        <h3>Exporter/Importer</h3>
        <button
          (click)="exportImage()"
          title="Sauvegarder le graphe comme une image"
        >
          <i class="tool-icon">ğŸ“·</i> Exporter Image
        </button>
        <button
          (click)="exportMatrix()"
          title="Exporter la matrice d'adjacence en JSON"
        >
          <i class="tool-icon">ğŸ“¤</i> Exporter Matrice
        </button>
        <div class="file-input-container">
          <label for="importMatrix" class="file-input-label">
            <i class="tool-icon">ğŸ“¥</i> Importer Matrice
          </label>
          <input
            type="file"
            id="importMatrix"
            accept=".json"
            (change)="importMatrix($event)"
            class="file-input"
          />
        </div>
      </div>

      <div class="tools-group">
        <h3>RÃ©soudre</h3>
        <button
          class="solve-btn"
          (click)="colorGraph()"
          [disabled]="isLoading || nodes.length === 0"
          title="RÃ©soudre le problÃ¨me de coloriage de graphe"
        >
          <i class="tool-icon">ğŸ¨</i> Colorier Graphe
        </button>

        <div class="result" *ngIf="chromaticNumber !== null" [@bounceAnimation]>
          <span>Nombre Chromatique: {{ chromaticNumber }}</span>
        </div>
      </div>

      <div class="loading-container" *ngIf="isLoading" [@fadeAnimation]>
        <div class="spinner"></div>
        <span>Traitement en cours...</span>
      </div>
    </div>

    <div class="canvas-container">
      <canvas #graphCanvas></canvas>
      <div class="instructions" *ngIf="nodes.length === 0" [@fadeAnimation]>
        <p>
          Cliquez n'importe oÃ¹ pour ajouter des nÅ“uds, puis connectez-les pour
          crÃ©er un graphe.
        </p>
        <p>Utilisez les outils Ã  gauche pour construire votre graphe.</p>
        <p>
          Quand vous Ãªtes prÃªt, cliquez sur "Colorier Graphe" pour trouver le
          nombre chromatique.
        </p>
      </div>
      <div class="mode-indicator" [@slideAnimation]>
        Mode: {{ mode | titlecase }}
        <span *ngIf="connecting" class="connecting-indicator"
          >Connexion depuis NÅ“ud {{ connecting.id }}</span
        >
      </div>
    </div>
  </div>

  <div
    class="matrix-editor"
    *ngIf="adjacencyMatrix.length > 0"
    [@slideAnimation]
  >
    <h3>Matrice d'Adjacence</h3>
    <p class="matrix-help">
      Modifiez les valeurs pour ajouter ou supprimer des connexions entre les
      nÅ“uds.
    </p>

    <div class="matrix-container">
      <table class="adjacency-matrix">
        <tr>
          <th></th>
          <th *ngFor="let node of nodes; let j = index">{{ j }}</th>
        </tr>
        <tr *ngFor="let row of adjacencyMatrix; let i = index">
          <th>{{ i }}</th>
          <td
            *ngFor="let cell of row; let j = index"
            [class.diagonal]="i === j"
            [class.editable]="i !== j"
            [@cellAnimation]="'in'"
          >
            <input
              type="number"
              min="0"
              max="1"
              [disabled]="i === j"
              [(ngModel)]="adjacencyMatrix[i][j]"
              (change)="matrixValueChanged(i, j)"
            />
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="tips-and-tricks" *ngIf="showTips">
    <h3>Astuces & Conseils</h3>
    <ul>
      <li>Utilisez la molette de la souris pour zoomer et dÃ©zoomer</li>
      <li>Faites glisser le canevas pour vous dÃ©placer</li>
      <li>Connectez les nÅ“uds en sÃ©lectionnant le mode "Connecter"</li>
      <li>
        L'algorithme de coloriage de graphe trouvera le nombre minimum de
        couleurs
      </li>
      <li>Vous pouvez modifier directement la matrice d'adjacence</li>
      <li>
        <strong>Application 1:</strong> Planification des horaires - Le coloriage de graphe est utilisÃ© pour allouer des crÃ©neaux horaires sans conflits pour des examens ou des rÃ©unions, oÃ¹ chaque nÅ“ud reprÃ©sente un Ã©vÃ©nement et les arÃªtes reprÃ©sentent des conflits.
      </li>
      <li>
        <strong>Application 2:</strong> Attribution de frÃ©quences radio - Pour Ã©viter les interfÃ©rences, les frÃ©quences radio peuvent Ãªtre modÃ©lisÃ©es comme un problÃ¨me de coloriage oÃ¹ chaque zone gÃ©ographique est un nÅ“ud et les couleurs sont les diffÃ©rentes frÃ©quences.
      </li>
    </ul>
    <button (click)="showTips = false" class="close-tips">Compris !</button>
  </div>
</div>
